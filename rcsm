#!/bin/rc

basedir=/etc/rcsm

fn usage {
	printf 'Usage: -a|-d|-c|-h|-k|-l|-s|-r\n'
	exit 0
}

fn run {
	if (test -z $2) {
		test -e $basedir/avail/$2 || printf 'Service not found\n'
		test -x $basedir/avail/$2 || printf 'Servicefile not executable\n'
		$basedir/avail/$2 $1 &
	}
	if not {
		for (serv in $basedir/run) {
			test -x $serv || printf 'Servicefile not executable\n'
			$basedir/run/$2 $1 &
		}
	}
}

switch($1) {
case -a
	if (test -e $basedir/avail/$2) {
		ln -sf $basedir/avail/$2 $basedir/run/
	}
	if not {
		printf 'Service not found\n'
		exit 1
	}
case -c
	test -d $basedir/run || mkdir -p $basedir/run
	test -d $basedir/avail || mkdir -p $basedir/avail
case -d
	rm -f $basedir/run/$2
case -h
	usage
case -l
	find $basedir/avail -type f
case -s
	run $1 $2
case -k
	run $1 $2
case *
	printf 'Invalid argument\n'
	usage
}
